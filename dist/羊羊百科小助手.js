GM_addStyle(GM_getResourceText("css")),$.noConflict(),jQuery(document).ready(function(e){e("body").append(GM_getResourceText("html")),(async()=>{console.log("[羊羊百科小助手]正在加载Vue……"),await e.getScript("https://cdn.jsdelivr.net/npm/vue/dist/vue.global.js"),console.log("[羊羊百科小助手]正在加载Naive UI……"),await e.getScript("https://cdn.jsdelivr.net/npm/naive-ui/dist/index.prod.js"),console.log("[羊羊百科小助手]正在加载axios……"),await e.getScript("https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"),console.log("[羊羊百科小助手]正在加载js-sleep……"),await e.getScript("https://cdn.jsdelivr.net/gh/colxi/js-sleep@master/js-sleep.js"),console.log("[羊羊百科小助手]正在启动程序……"),await function(){const t={setup(){let t="";location.href.match(/www.youtube.com\/playlist*/)&&(t="优兔"),location.href.match(/item.taobao.com\/item.htm*/)&&(t="淘宝"),location.href.match(/detail.tmall.com\/item.htm*/)&&(t="天猫"),location.href.match(/www.mgtv.com\/h\/*/)&&(t="芒果TV");let a=naive.darkTheme,n=naive.zhCN;osThemeRef=naive.useOsTheme();let l=Vue.ref(""),o=Vue.ref({pagename:"",price:"",date:null,feat:"",ifImgDownload:!1}),i=Vue.ref(!1);return{showDrawer:Vue.ref(!1),resCode:l,currentSite:t,productItem:o,getYouTubeList:function(t){if(console.log("正在获取优兔播放列表……"),""===e("div#primary").text())l.value="网页未加载完成。请等待网页加载完毕后再试。";else{let a={link:[],title:[],wiki:[]};e("a#video-title").each((t,n)=>{let l="https://youtu.be/"+e(n).attr("href").match(/v=(.*?)&/)[1],o=e(n).attr("title")+" - YouTube",i=`[${l} ${o}]`;a.link=a.link.concat(l),a.title=a.title.concat(o),a.wiki=a.wiki.concat(i)}),l.value=a[t].join("\n")}},getTaobaoItem:async function(){o.value.pagename=o.value.pagename||"页面名称",o.value.price=o.value.price||e("#J_StrPrice>.tb-rmb-num").text();let t=`https://item.taobao.com/item.htm?id=${g_config.itemId}`,a=g_config.idata.item.auctionImages,n=JSON.parse(GM_getResourceText("json")).Taobao2Brand[g_config.shopName]||"",i="";JSON.parse(GM_getResourceText("json")).series.forEach(e=>{g_config.idata.item.title.includes(e)&&(i=e)}),o.value.feat=o.value.feat||i,e("#J_isku .J_TSaleProp a").each((t,n)=>{e(n).attr("style")&&(a=a.concat(e(n).attr("style").replace("background:url(","").replace("_30x30.jpg) center no-repeat;","")))}),a.forEach((e,t)=>{a[t]=e.replace(/\/\/gd\d./,"https://gd1.")});let c=[];(a=Array.from(new Set(a))).forEach((e,t)=>{o.value.ifImgDownload&&GM_download(e,o.value.pagename+(t+1)+e.slice(-4)),c=c.concat(o.value.pagename+(t+1)+e.slice(-4))});let s=c.join("\n"),r=[],u=[],m="";e("#J_DivItemDesc img").each((t,a)=>{let n=e(a).attr("src");n="http"===n.slice(0,4)?n:"https:"+n,r=r.concat(n)}),console.log(r),r.forEach((e,t)=>{o.value.ifImgDownload&&GM_download(e,o.value.pagename+" 描述图"+(t+1)+e.slice(-4)),u=u.concat(o.value.pagename+" 描述图"+(t+1)+e.slice(-4))}),m=u.join("|"),l.value=`{{周边信息\n|版权=\n|尺寸=\n|定价=${o.value.price}\n|货号=\n|链接（京东）=\n|链接（乐乎市集）=\n|链接（奇货）=\n|链接（淘宝）=${t}\n|链接（天猫）=\n|链接（玩具反斗城）=\n|品牌=${n}\n|日期=${o.value.date||""}\n|适龄=\n|条码=\n|主题=${o.value.feat}\n}}\n\n<gallery>\n${s}\n</gallery>\n\n{{长图|${m}}}\n`},getTianmaoItem:async function(){o.value.pagename=o.value.pagename||"页面名称",o.value.price=o.value.price||e("[class^=Price--originPrice] [class^=Price--priceText--2nLbVda]").text();let t="";JSON.parse(GM_getResourceText("json")).series.forEach(a=>{e("[class^=ItemHeader--mainTitle]").text().includes(a)&&(t=a)}),o.value.feat=o.value.feat||t;let a=JSON.parse(GM_getResourceText("json")).Tianmao2Brand[e("[class^=ShopFloat--title]").text()]||"",n="https://detail.tmall.com/item.htm?id="+e("#aliww-click-trigger").attr("data-item"),i=[];e(".descV8-richtext p img").each((t,a)=>{i=i.concat(e(a).attr("src")),console.log(i)});let c=[];i.forEach((e,t)=>{c[t]=o.value.pagename+" 描述图"+(t+1)+e.slice(-4),o.value.ifImgDownload&&GM_download(e,c[t])});let s=c.join("|"),r=[];e("[class^=PicGallery--thumbnailPic]").each((t,a)=>{r=r.concat(e(a).attr("src"))}),e(".skuIcon").each((t,a)=>{r=r.concat(e(a).attr("src"))}),r.forEach((e,t)=>{r[t]="https:"+e.replace("_110x10000Q75.jpg_.webp","").replace("_60x60q50.jpg_.webp","")});let u=[];(r=Array.from(new Set(r))).forEach((e,t)=>{u[t]=o.value.pagename+(t+1)+e.slice(-4),o.value.ifImgDownload&&GM_download(e,u[t])});let m=u.join("\n");l.value=`{{周边信息\n|版权=\n|尺寸=\n|定价=${o.value.price}\n|货号=\n|链接（京东）=\n|链接（乐乎市集）=\n|链接（奇货）=\n|链接（淘宝）=\n|链接（天猫）=${n}\n|链接（玩具反斗城）=\n|品牌=${a}\n|日期=${o.value.date||""}\n|适龄=\n|条码=\n|主题=${feat}\n}}\n\n<gallery>\n${m}\n</gallery>\n\n{{长图|${s}}}\n`},getMangguoList:async function(e){i.value=!0;let t=__NUXT__.data[0].collection_id,a=1,n=[];if("undefined"==typeof xyy){do{var o=await axios.get(`https://pcweb2.api.mgtv.com/episode/list?collection_id=${t}&page=${a}`);a++,console.log(`page=${o.data.data.current_page}`),n=n.concat(o.data.data.list),await sleep(1e3)}while(o.data.data.total_page!=o.data.data.current_page);window.xyy=n}else n=xyy;let c={link:"",title:""};n.forEach(e=>{c.link=c.link+"https://www.mgtv.com"+e.url+"\n",c.title=c.title+e.t2+"\n"}),l.value=c[e],i.value=!1},darkTheme:a,zhCN:n,loading:i,theme:Vue.computed(()=>"dark"===osThemeRef.value?a:null),osTheme:osThemeRef}}},a=Vue.createApp(t);a.use(naive),a.mount("#XYY-huijiwiki-helper")}(),console.log("[羊羊百科小助手]启动完成。")})()});