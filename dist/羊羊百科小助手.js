GM_addStyle(GM_getResourceText("css")),$.noConflict(),jQuery(document).ready(function(e){e("body").append(GM_getResourceText("html")),(async()=>{console.log("[羊羊百科小助手]正在加载Vue……"),await e.getScript("https://cdn.jsdelivr.net/npm/vue/dist/vue.global.js"),console.log("[羊羊百科小助手]正在加载Naive UI……"),await e.getScript("https://cdn.jsdelivr.net/npm/naive-ui/dist/index.prod.js"),console.log("[羊羊百科小助手]正在加载axios……"),await e.getScript("https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"),console.log("[羊羊百科小助手]正在加载js-sleep……"),await e.getScript("https://cdn.jsdelivr.net/gh/colxi/js-sleep@master/js-sleep.js"),console.log("[羊羊百科小助手]正在启动程序……"),await function(){const a={setup(){let a="";location.href.match(/www.youtube.com\/playlist*/)&&(a="优兔"),location.href.match(/item.taobao.com\/item.htm*/)&&(a="淘宝"),location.href.match(/detail.tmall.com\/item.htm*/)&&(a="天猫"),location.href.match(/www.mgtv.com\/h\/*/)&&(a="芒果TV");let t=naive.darkTheme,l=naive.zhCN;osThemeRef=naive.useOsTheme();let n=Vue.ref(""),o=Vue.ref({pagename:"",price:"",date:null,feat:"",ifImgDownload:!1}),i=Vue.ref(!1);return{showDrawer:Vue.ref(!1),resCode:n,currentSite:a,productItem:o,getYouTubeList:function(a){if(console.log("正在获取优兔播放列表……"),""===e("div#primary").text())n.value="网页未加载完成。请等待网页加载完毕后再试。";else{let t={link:[],title:[],wiki:[]};e("a#video-title").each((a,l)=>{let n="https://youtu.be/"+e(l).attr("href").match(/v=(.*?)&/)[1],o=e(l).attr("title")+" - YouTube",i=`[${n} ${o}]`;t.link=t.link.concat(n),t.title=t.title.concat(o),t.wiki=t.wiki.concat(i)}),n.value=t[a].join("\n")}},getTaobaoItem:async function(){o.value.pagename=o.value.pagename||"页面名称",o.value.price=o.value.price||e("#J_StrPrice>.tb-rmb-num").text();let a=`https://item.taobao.com/item.htm?id=${g_config.itemId}`,t=g_config.idata.item.auctionImages,l=JSON.parse(GM_getResourceText("json")).Taobao2Brand[g_config.shopName]||"",i="";JSON.parse(GM_getResourceText("json")).series.forEach(e=>{g_config.idata.item.title.includes(e)&&(i=e)}),o.value.feat=o.value.feat||i,e("#J_isku .J_TSaleProp a").each((a,l)=>{e(l).attr("style")&&(t=t.concat(e(l).attr("style").replace("background:url(","").replace("_30x30.jpg) center no-repeat;","")))}),t.forEach((e,a)=>{t[a]=e.replace(/\/\/gd\d./,"https://gd1.")});let c=[];(t=Array.from(new Set(t))).forEach((e,a)=>{o.value.ifImgDownload&&GM_download(e,o.value.pagename+(a+1)+e.slice(-4)),c=c.concat(o.value.pagename+(a+1)+e.slice(-4))});let s=c.join("\n"),r=[],u=[],m="";e("#J_DivItemDesc img").each((a,t)=>{let l=e(t).attr("src");l="http"===l.slice(0,4)?l:"https:"+l,r=r.concat(l)}),console.log(r),r.forEach((e,a)=>{o.value.ifImgDownload&&GM_download(e,o.value.pagename+" 描述图"+(a+1)+e.slice(-4)),u=u.concat(o.value.pagename+" 描述图"+(a+1)+e.slice(-4))}),m=u.join("|"),n.value=`{{周边信息\n|版权=\n|尺寸=\n|定价=${o.value.price}\n|货号=\n|链接（京东）=\n|链接（乐乎市集）=\n|链接（奇货）=\n|链接（淘宝）=${a}\n|链接（天猫）=\n|链接（玩具反斗城）=\n|品牌=${l}\n|日期=${o.value.date||""}\n|适龄=\n|条码=\n|主题=${o.value.feat}\n}}\n\n<gallery>\n${s}\n</gallery>\n\n{{长图|${m}}}\n`,o.value.ifAutoCopy&&(navigator.clipboard.writeText(n.value),alert("复制成功！"))},getTianmaoItem:async function(){i.value=!0,o.value.pagename=o.value.pagename||"页面名称",o.value.price=o.value.price||e("[class^=Price--originPrice] [class^=Price--priceText--2nLbVda]").text();let a="";JSON.parse(GM_getResourceText("json")).series.forEach(t=>{e("[class^=ItemHeader--mainTitle]").text().includes(t)&&(a=t)}),o.value.feat=o.value.feat||a;let t=JSON.parse(GM_getResourceText("json")).Tianmao2Brand[e("[class^=ShopFloat--title]").text()]||"",l="https://detail.tmall.com/item.htm?id="+e("#aliww-click-trigger").attr("data-item"),c=[];e("[class^='descV8'] img").each((a,t)=>{let l=e(t).attr("src");"//gw.alicdn.com/tfs/TB1d0h2qVYqK1RjSZLeXXbXppXa-1125-960.png?getAvatar=avatar"!==l&&"https://assets.alicdn.com/kissy/1.0.0/build/imglazyload/spaceball.gif"!==l&&(c=c.concat(l))}),console.log("longImgList"),console.log(c);let s=[];c.forEach((e,a)=>{s[a]=o.value.pagename+" 描述图"+(a+1)+e.slice(-4),o.value.ifImgDownload&&GM_download(e,s[a])});let r=s.join("|");async function u(e){let a=await fetch(e),t=await a.blob();return new Promise(e=>{let a=new FileReader;a.onloadend=function(){e(a.result)},a.readAsDataURL(t)})}let m=e("[class^=PicGallery--thumbnailPic], .skuIcon").map((a,t)=>e(t).attr("src")).get();m=m.map(e=>"https:"+e.replace(/\.(jpg|png).*?_\.webp$/,".$1"));let p=(m=await async function(e){let a=await Promise.all(e.map(u)),t=[...new Set(a)],l=[];for(let n=0;n<t.length;n++)l[n]=e[a.indexOf(t[n])];return l}(m)).map((e,a)=>o.value.pagename+(a+1)+e.slice(-4));o.value.ifImgDownload&&p.forEach((e,a)=>GM_download(m[a],e));let d=p.join("\n");n.value=`{{周边信息\n|版权=\n|尺寸=\n|定价=${o.value.price}\n|货号=\n|链接（京东）=\n|链接（乐乎市集）=\n|链接（奇货）=\n|链接（淘宝）=\n|链接（天猫）=${l}\n|链接（玩具反斗城）=\n|品牌=${t}\n|日期=${o.value.date||""}\n|适龄=\n|条码=\n|主题=${o.value.feat}\n}}\n\n<gallery>\n${d}\n</gallery>\n\n{{长图|${r}}}\n`,o.value.ifAutoCopy&&(navigator.clipboard.writeText(n.value),alert("复制成功！"));i.value=!1},getMangguoList:async function(e){i.value=!0;let a=__NUXT__.data[0].collection_id,t=1,l=[];if("undefined"==typeof xyy){do{var o=await axios.get(`https://pcweb2.api.mgtv.com/episode/list?collection_id=${a}&page=${t}`);t++,console.log(`page=${o.data.data.current_page}`),l=l.concat(o.data.data.list),await sleep(1e3)}while(o.data.data.total_page!=o.data.data.current_page);window.xyy=l}else l=xyy;let c={link:"",title:""};l.forEach(e=>{c.link=c.link+"https://www.mgtv.com"+e.url+"\n",c.title=c.title+e.t2+"\n"}),n.value=c[e],i.value=!1},darkTheme:t,zhCN:l,loading:i,theme:Vue.computed(()=>"dark"===osThemeRef.value?t:null),osTheme:osThemeRef}}},t=Vue.createApp(a);t.use(naive),t.mount("#XYY-huijiwiki-helper")}(),console.log("[羊羊百科小助手]启动完成。")})()});